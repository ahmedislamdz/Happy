const path = require('path');
const fs = require('fs');
const glob = require('glob');
function deleteFileByGlob(reg) {
    glob(reg, {}, function (err, files) {
        if (err) {
            return console.log('vite-plugin-static-manage:error', err);
        }
        files.map(file => fs.unlink(file, () => { }));
    });
}
module.exports = function vitePluginStaticManage(config) {
    return {
        name: 'vite-plugin-static-manage',
        renderStart(outputOptions) {
            const { ignore } = config;
            if (Array.isArray(ignore)) {
                const outDir = outputOptions.dir;
                ignore.forEach(reg => deleteFileByGlob(path.resolve(outDir, reg)));
            }
        }
    };
};
